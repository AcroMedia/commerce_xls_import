<?php

/**
 * @file
 * Commerce_xls_import.test.
 *
 * Tests.
 */

/**
 * Class CommerceXlsImportTestCase.
 *
 */
class CommerceXlsImportTestCase extends DrupalWebTestCase {
  protected $adminUser;
  protected $privilegedUser;
  protected $normalUser;

  /**
   * GetInfo().
   *
   * @return array
   *  An array containing name, description, and group text.
   */
  public static function getInfo() {
    return array(
      'name' => 'Commerce XLS Import Tests',
      'description' => 'Ensure Commerce XLS Import functions properly',
      'group' => 'Drupal Commerce',
    );
  }

  /**
   * Setup().
   * @{inheritdoc}
   */
  public function setUp() {

    parent::setUp(array('commerce_product_ui', 'commerce_xls_import'));

    $this->adminUser = $this->drupalCreateUser(array(
      'administer users',
      'administer permissions',
    ));

    $this->privilegedUser = $this->drupalCreateUser(array(
      'administer commerce import',
    ));

    $this->normalUser = $this->drupalCreateUser();
  }

  /**
   * Test permissions.
   */
  public function testCommerceXlsImportPermissions() {
    $this->drupalLogin($this->privilegedUser);
    $this->drupalGet('admin/commerce/products/import_commerce');
    $this->assertResponse('200', 'Privileged user was able to correctly access the admin page');

    $this->drupalLogin($this->normalUser);
    $this->drupalGet('admin/commerce/products/import_commerce');
    $this->assertResponse('403', 'Unprivileged user was unable to access the admin page');
  }

  /**
   * Test product types
   */
  public function testCommerceXlsImportProductTypes() {
    $this->drupalLogin($this->privilegedUser);
    $this->drupalGet('admin/commerce/products/import_commerce');
    $this->assertFieldByXPath("//select[@name='product_type']/option[@value='product']", 'Product', 'Product type \'Product\' found');
  }
}
